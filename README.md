# ğŸ” Wenzbak - æ¸©çŸ¥ç¬¬ä¸‰æ–¹æ•°æ®åŒæ­¥ç³»ç»Ÿ

<div align="center">

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![Dart](https://img.shields.io/badge/Dart-3.8%2B-blue.svg)](https://dart.dev)
[![Flutter](https://img.shields.io/badge/Flutter-Compatible-green.svg)](https://flutter.dev)

**å¸®åŠ©ç¬”è®°ç±»å·¥å…·å¿«é€Ÿå»ºç«‹è‡ªå·±çš„æ•°æ®å¤‡ä»½åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æ•°æ®æä¾›å®‰å…¨ä¿éšœ**

[ç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [æ–‡æ¡£](#-æ–‡æ¡£) â€¢ [ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹) â€¢ [è§†é¢‘](#-è§†é¢‘ä»‹ç») â€¢ [è´¡çŒ®](#-è´¡çŒ®)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Wenzbak æ˜¯ä¸€ä¸ªä¸“ä¸ºç¬”è®°ç±»åº”ç”¨è®¾è®¡çš„æ•°æ®å¤‡ä»½ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„æ•°æ®å¤‡ä»½ã€åŒæ­¥å’ŒåŠ å¯†è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ç®€å•çš„ API é›†æˆï¼Œè®©ä½ çš„åº”ç”¨å¿«é€Ÿæ‹¥æœ‰ä¼ä¸šçº§çš„æ•°æ®å¤‡ä»½èƒ½åŠ›ã€‚

### ğŸ¥ è§†é¢‘ä»‹ç»

ğŸ“º [Bç«™è§†é¢‘ä»‹ç»](https://www.bilibili.com/video/BV11rkLBZELG/)

### ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹© Wenzbakï¼Ÿ

- âœ… **å¼€ç®±å³ç”¨** - å‡ è¡Œä»£ç å³å¯é›†æˆå®Œæ•´çš„å¤‡ä»½åŠŸèƒ½
- âœ… **å¤šå­˜å‚¨æ”¯æŒ** - æ”¯æŒ S3ã€WebDAVã€æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç­‰å¤šç§å­˜å‚¨åç«¯
- âœ… **æ•°æ®å®‰å…¨** - å†…ç½®åŠ å¯†åŠŸèƒ½ï¼Œä¿æŠ¤ç”¨æˆ·éšç§
- âœ… **å¢é‡åŒæ­¥** - æ™ºèƒ½å¢é‡å¤‡ä»½ï¼ŒèŠ‚çœå¸¦å®½å’Œæ—¶é—´
- âœ… **è·¨è®¾å¤‡åŒæ­¥** - æ”¯æŒå¤šè®¾å¤‡é—´çš„æ•°æ®åŒæ­¥å’Œæ¶ˆæ¯æ¨é€
- âœ… **è½»é‡çº§** - çº¯ Dart å®ç°ï¼Œæ— é¢å¤–ä¾èµ–

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ“¦ æ•°æ®å¤‡ä»½
- **å¢é‡å¤‡ä»½** - åªåŒæ­¥å˜æ›´çš„æ•°æ®ï¼Œå¤§å¹…å‡å°‘ä¼ è¾“é‡
- **æ•°æ®åˆå¹¶** - è‡ªåŠ¨åˆå¹¶å†å²æ•°æ®ï¼Œä¼˜åŒ–å­˜å‚¨ç»“æ„
- **æ–­ç‚¹ç»­ä¼ ** - æ”¯æŒä¸Šä¼ å¤±è´¥åè‡ªåŠ¨é‡è¯•

### ğŸ”’ æ•°æ®åŠ å¯†
- **ç«¯åˆ°ç«¯åŠ å¯†** - æ”¯æŒ AES åŠ å¯†ï¼Œæ•°æ®åœ¨ä¼ è¾“å’Œå­˜å‚¨æ—¶éƒ½å—åˆ°ä¿æŠ¤
- **å¯†é’¥éš”ç¦»** - æ”¯æŒå¤šå¯†é’¥ç®¡ç†ï¼Œä¸åŒå¯†é’¥çš„æ•°æ®å®Œå…¨éš”ç¦»
- **å¯é€‰åŠ å¯†** - å¯é€‰æ‹©å¯ç”¨æˆ–ç¦ç”¨åŠ å¯†åŠŸèƒ½

### ğŸ“ æ–‡ä»¶ç®¡ç†
- **æ–‡ä»¶ä¸Šä¼ ** - æ”¯æŒä»»æ„æ–‡ä»¶ç±»å‹çš„ä¸Šä¼ å’Œä¸‹è½½
- **SHA256 æ ¡éªŒ** - è‡ªåŠ¨æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§ï¼Œé¿å…é‡å¤ä¸Šä¼ 
- **ä¸´æ—¶æ–‡ä»¶** - æ”¯æŒä¸´æ—¶æ–‡ä»¶çš„è‡ªåŠ¨æ¸…ç†æœºåˆ¶

### ğŸ’¬ æ¶ˆæ¯åŒæ­¥
- **å®æ—¶æ¶ˆæ¯** - æ”¯æŒè·¨è®¾å¤‡çš„æ¶ˆæ¯æ¨é€ï¼ˆè½®è¯¢æœºåˆ¶ï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—** - å¯é çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±
- **è‡ªåŠ¨é‡è¯•** - æ¶ˆæ¯å‘é€å¤±è´¥è‡ªåŠ¨é‡è¯•

### ğŸŒ å¤šå­˜å‚¨åç«¯
- **S3 å…¼å®¹** - æ”¯æŒ AWS S3ã€MinIO ç­‰ S3 å…¼å®¹å­˜å‚¨
- **WebDAV** - æ”¯æŒ WebDAV åè®®ï¼Œå…¼å®¹ Nextcloudã€OwnCloud ç­‰
- **æœ¬åœ°æ–‡ä»¶** - æ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼ˆç”¨äºæµ‹è¯•ï¼‰

### ğŸ“± è®¾å¤‡ç®¡ç†
- **è®¾å¤‡ä¿¡æ¯** - è‡ªåŠ¨è·å–å’Œç®¡ç†è®¾å¤‡ä¿¡æ¯
- **å¤šè®¾å¤‡æ”¯æŒ** - æ”¯æŒåŒä¸€è´¦æˆ·ä¸‹çš„å¤šè®¾å¤‡ç®¡ç†
- **è®¾å¤‡æŸ¥è¯¢** - å¿«é€ŸæŸ¥è¯¢æ‰€æœ‰è®¾å¤‡ä¿¡æ¯

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

åœ¨ `pubspec.yaml` ä¸­æ·»åŠ ä¾èµ–ï¼š

```yaml
dependencies:
  wenzbak:
    git:
      url: https://github.com/lyming99/wenzbak.git
      ref: main
```

æˆ–è€…ä½¿ç”¨æœ¬åœ°è·¯å¾„ï¼š

```yaml
dependencies:
  wenzbak:
    path: ../wenzbak
```

### åŸºæœ¬ä½¿ç”¨

#### 1. é…ç½®å­˜å‚¨åç«¯

**æ–¹å¼ä¸€ï¼šç›´æ¥æ³¨å…¥ Storage å®ä¾‹ï¼ˆæ¨èï¼‰**

```dart
import 'package:wenzbak/wenzbak.dart';
import 'package:wenzbak/src/service/storage/impl/s3_storage_client.dart';
import 'package:wenzbak/src/service/storage/impl/webdav_storage_client.dart';
import 'package:wenzbak/src/service/storage/impl/file_storage_client.dart';

// S3/MinIO
final s3Storage = S3StorageClient(
  config,
  'http://localhost:9000',
  'minioadmin',
  'minioadmin',
  'wenzbak',
  'us-east-1',
);
var config = WenzbakConfig(
  deviceId: 'device-001',
  localRootPath: './local_backup',
  remoteRootPath: 'wenzbak',
  storage: s3Storage,  // ç›´æ¥æ³¨å…¥
);

// WebDAV
final webdavStorage = WebDAVStorageClient(
  config,
  'http://localhost:8080',
  'webdav',
  'webdav',
);
var config = WenzbakConfig(
  deviceId: 'device-001',
  localRootPath: './local_backup',
  remoteRootPath: 'wenzbak',
  storage: webdavStorage,  // ç›´æ¥æ³¨å…¥
);

// æœ¬åœ°æ–‡ä»¶
final fileStorage = FileStorageClient(config, '/path/to/storage');
var config = WenzbakConfig(
  deviceId: 'device-001',
  localRootPath: './local_backup',
  remoteRootPath: 'wenzbak',
  storage: fileStorage,  // ç›´æ¥æ³¨å…¥
);
```

**æ–¹å¼äºŒï¼šä½¿ç”¨é…ç½®å­—ç¬¦ä¸²ï¼ˆå…¼å®¹æ—§æ–¹å¼ï¼‰**

```dart
import 'dart:convert';
import 'package:wenzbak/wenzbak.dart';

// S3/MinIO
var s3Config = {
  'endpoint': 'http://localhost:9000',
  'accessKey': 'minioadmin',
  'secretKey': 'minioadmin',
  'bucket': 'wenzbak',
  'region': 'us-east-1',
};

var config = WenzbakConfig(
  deviceId: 'device-001',
  localRootPath: './local_backup',
  remoteRootPath: 'wenzbak',
  storageType: 's3',
  storageConfig: jsonEncode(s3Config),
);

// WebDAV
var webdavConfig = {
  'url': 'http://localhost:8080',
  'username': 'webdav',
  'password': 'webdav',
};

var config = WenzbakConfig(
  deviceId: 'device-001',
  localRootPath: './local_backup',
  remoteRootPath: 'wenzbak',
  storageType: 'webdav',
  storageConfig: jsonEncode(webdavConfig),
);
```

> **æ³¨æ„**ï¼šæ¨èä½¿ç”¨æ–¹å¼ä¸€ç›´æ¥æ³¨å…¥ Storage å®ä¾‹ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°æ”¯æŒè‡ªå®šä¹‰ Storage å®ç°å’Œå•å…ƒæµ‹è¯•ã€‚

#### 2. åˆ›å»ºå®¢æˆ·ç«¯

```dart
var backupClient = WenzbakClientServiceImpl(config);
```

#### 3. ä¸Šä¼ è®¾å¤‡ä¿¡æ¯

```dart
await backupClient.uploadDeviceInfo();
```

#### 4. å¤‡ä»½æ•°æ®

```dart
// æ·»åŠ æ•°æ®åˆ°å¤‡ä»½é˜Ÿåˆ—
await backupClient.addBackupData(
  WenzbakDataLine(
    createTime: DateTime.now(),
    content: "ä½ çš„æ•°æ®å†…å®¹",
  ),
);

// ä¸Šä¼ æ‰€æœ‰å¾…å¤‡ä»½çš„æ•°æ®
await backupClient.uploadAllData(false);
```

#### 5. ä¸‹è½½æ•°æ®

```dart
// æ·»åŠ æ•°æ®æ¥æ”¶å™¨
backupClient.addDataReceiver((line) async {
  print('æ”¶åˆ°æ•°æ®: ${line.content}');
});

// ä¸‹è½½æ‰€æœ‰æ•°æ®ï¼ˆå¢é‡ä¸‹è½½ï¼‰
await backupClient.downloadAllData();
```

---

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### æ•°æ®å¤‡ä»½ç¤ºä¾‹

```dart
// æ·»åŠ æ•°æ®
await backupClient.addBackupData(
  WenzbakDataLine(
    createTime: DateTime.now(),
    content: "ç¬”è®°å†…å®¹",
  ),
);

// ä¸Šä¼ æ•°æ®
await backupClient.uploadAllData(false);

// åˆå¹¶å†å²æ•°æ®
await backupClient.mergeHistoryData();
```

### æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹

```dart
// ä¸Šä¼ æ–‡ä»¶
var remotePath = await backupClient.uploadAssets('./local_file.txt');
if (remotePath != null) {
  print('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: $remotePath');
}
```

### æ¶ˆæ¯åŒæ­¥ç¤ºä¾‹

```dart
// å‘é€æ¶ˆæ¯
var message = WenzbakMessage(
  uuid: Uuid().v4(),
  content: 'Hello from device-001!',
  timestamp: DateTime.now().millisecondsSinceEpoch,
);
await backupClient.messageService.sendMessage(message);

// æ¥æ”¶æ¶ˆæ¯
backupClient.addMessageReceiver((message) async {
  print('æ”¶åˆ°æ¶ˆæ¯: ${message.content}');
});

// å¯åŠ¨è‡ªåŠ¨è½®è¯¢
backupClient.startMessageTimer();
```

### åŠ å¯†æ•°æ®ç¤ºä¾‹

```dart
var config = WenzbakConfig(
  deviceId: 'device-001',
  localRootPath: './local_backup',
  remoteRootPath: 'wenzbak',
  storageType: 's3',
  storageConfig: jsonEncode(s3Config),
  secretKey: 'my-secret-key', // å¯ç”¨åŠ å¯†
  encryptFile: true,           // åŠ å¯†æ–‡ä»¶
);
```

æ›´å¤šç¤ºä¾‹è¯·æŸ¥çœ‹ [example](./example) ç›®å½•ã€‚

---

## ğŸ“– æ–‡æ¡£

- [è®¾å¤‡æœåŠ¡æ–‡æ¡£](./docs/device/DEVICE_SERVICE.md) - è®¾å¤‡ä¿¡æ¯ç®¡ç†
- [æ–‡ä»¶ä¸Šä¼ æ–‡æ¡£](./docs/file/upload.md) - æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [MinIO å¿«é€Ÿå¼€å§‹](./docs/minio/QUICKSTART_MINIO.md) - MinIO å­˜å‚¨é…ç½®
- [WebDAV å¿«é€Ÿå¼€å§‹](./docs/webdav/QUICKSTART_WEBDAV.md) - WebDAV å­˜å‚¨é…ç½®
- [WebDAV è®¾ç½®æŒ‡å—](./docs/webdav/WEBDAV_SETUP.md) - WebDAV è¯¦ç»†é…ç½®

---

## ğŸ› ï¸ æ”¯æŒçš„å­˜å‚¨åç«¯

| å­˜å‚¨ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| **S3** | âœ… æ”¯æŒ | æ”¯æŒ AWS S3ã€MinIO ç­‰ S3 å…¼å®¹å­˜å‚¨ |
| **WebDAV** | âœ… æ”¯æŒ | æ”¯æŒ Nextcloudã€OwnCloud ç­‰ WebDAV æœåŠ¡å™¨ |
| **æœ¬åœ°æ–‡ä»¶** | âœ… æ”¯æŒ | ç”¨äºå¼€å‘å’Œæµ‹è¯• |
| **FTP/SFTP** | ğŸš§ è®¡åˆ’ä¸­ | å³å°†æ”¯æŒ |

---

## ğŸ“‹ åŠŸèƒ½è·¯çº¿å›¾

- [x] æ–‡ä»¶å¤‡ä»½
- [x] æ•°æ®å¤‡ä»½
- [x] æ•°æ®åŠ å¯†
- [x] æ•°æ®å‹ç¼©ä¼˜åŒ–
- [x] å¢é‡åŒæ­¥
- [x] å®æ—¶æ¶ˆæ¯ï¼ˆè½®è¯¢ï¼‰
- [x] WebDAV æ”¯æŒ
- [x] S3 æ”¯æŒ
- [ ] FTP/SFTP æ”¯æŒ
- [ ] æ›´å¤šå­˜å‚¨åç«¯æ”¯æŒ

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### å¼€å‘æŒ‡å—

1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/lyming99/wenzbak.git
cd wenzbak
```

2. å®‰è£…ä¾èµ–
```bash
dart pub get
```

3. è¿è¡Œæµ‹è¯•
```bash
dart test
```

---

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache 2.0](LICENSE) è®¸å¯è¯ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

## ğŸ“® è”ç³»æ–¹å¼

- æäº¤ Issue: [GitHub Issues](https://github.com/lyming99/wenzbak/issues)
- è®¨è®ºåŒº: [GitHub Discussions](https://github.com/lyming99/wenzbak/discussions)

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª â­ Starï¼**

Made with â¤ï¸ by the lyming99

</div>
